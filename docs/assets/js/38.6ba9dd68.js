(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{538:function(e,t,r){"use strict";r.r(t);var n=r(6),s=Object(n.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"使用-fetch"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#使用-fetch"}},[e._v("#")]),e._v(" 使用 Fetch")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API",target:"_blank",rel:"noopener noreferrer"}},[e._v("Fetch API"),r("OutboundLink")],1),e._v(" 提供了一个 JavaScript 接口，用于访问和操纵 HTTP 管道的一些具体部分，例如请求和响应。它还提供了一个全局 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/WindowOrWorkerGlobalScope/fetch",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("fetch()")]),r("OutboundLink")],1),e._v(" 方法，该方法提供了一种简单，合理的方式来跨网络异步获取资源。")]),e._v(" "),r("p",[e._v("这种功能以前是使用 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("XMLHttpRequest")]),r("OutboundLink")],1),e._v(" 实现的。Fetch 提供了一个更理想的替代方案，可以很容易地被其他技术使用，例如 "),r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Service Workers")]),e._v(" (en-US)"),r("OutboundLink")],1),e._v("。Fetch 还提供了专门的逻辑空间来定义其他与 HTTP 相关的概念，例如 CORS 和 HTTP 的扩展。")]),e._v(" "),r("p",[e._v("请注意，"),r("code",[e._v("fetch")]),e._v(" 规范与 "),r("code",[e._v("jQuery.ajax()")]),e._v(" 主要有三种方式的不同：")]),e._v(" "),r("ul",[r("li",[e._v("当接收到一个代表错误的 HTTP 状态码时，从 "),r("code",[e._v("fetch()")]),e._v(" 返回的 Promise "),r("strong",[e._v("不会被标记为 reject，")]),e._v(" 即使响应的 HTTP 状态码是 404 或 500。相反，它会将 Promise 状态标记为 resolve （但是会将 resolve 的返回值的 "),r("code",[e._v("ok")]),e._v(" 属性设置为 false ），仅当网络故障时或请求被阻止时，才会标记为 reject。")]),e._v(" "),r("li",[r("code",[e._v("fetch()")]),e._v(" **可以不会接受跨域 cookies；**你也可以不能使用 "),r("code",[e._v("fetch()")]),e._v(" 建立起跨域会话。其他网站的 "),r("code",[e._v("Set-Cookie")]),e._v(" 头部字段将会被无视。")]),e._v(" "),r("li",[r("code",[e._v("fetch")]),e._v(" "),r("strong",[e._v("不会发送 cookies")]),e._v("。除非你使用了"),r("em",[e._v("credentials")]),e._v(" 的"),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters",target:"_blank",rel:"noopener noreferrer"}},[e._v("初始化选项"),r("OutboundLink")],1),e._v("。（自 2017 年 8 月 25 日以后，默认的 credentials 政策变更为 "),r("code",[e._v("same-origin")]),e._v("。Firefox 也在 61.0b13 版本中进行了修改）")])]),e._v(" "),r("p",[e._v("一个基本的 fetch 请求设置起来很简单。看看下面的代码：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("fetch('http://example.com/movies.json')\n  .then(function(response) {\n    return response.json();\n  })\n  .then(function(myJson) {\n    console.log(myJson);\n  });\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("p",[e._v("这里我们通过网络获取一个 JSON 文件并将其打印到控制台。最简单的用法是只提供一个参数用来指明想 "),r("code",[e._v("fetch()")]),e._v(" 到的资源路径，然后返回一个包含响应结果的promise（一个 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Response",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Response")]),r("OutboundLink")],1),e._v(" 对象）。")]),e._v(" "),r("p",[e._v("当然它只是一个 HTTP 响应，而不是真的JSON。为了获取JSON的内容，我们需要使用 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/orphaned/Web/API/Body/json",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("json()")]),r("OutboundLink")],1),e._v(" 方法（在 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/orphaned/Web/API/Body",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Body")]),r("OutboundLink")],1),e._v(" mixin 中定义，被 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Request",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Request")]),r("OutboundLink")],1),e._v(" 和 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Response",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Response")]),r("OutboundLink")],1),e._v(" 对象实现）。")]),e._v(" "),r("p",[r("strong",[e._v("注意")]),e._v("：Body mixin 还有其他相似的方法，用于获取其他类型的内容。参考 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#body",target:"_blank",rel:"noopener noreferrer"}},[e._v("Body"),r("OutboundLink")],1),e._v("。")]),e._v(" "),r("p",[e._v("最好使用符合"),r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy",target:"_blank",rel:"noopener noreferrer"}},[e._v("内容安全策略 (CSP) (en-US)"),r("OutboundLink")],1),e._v("的链接而不是使用直接指向资源地址的方式来进行Fetch的请求。")]),e._v(" "),r("h3",{attrs:{id:"支持的请求参数"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#支持的请求参数"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#%E6%94%AF%E6%8C%81%E7%9A%84%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0",target:"_blank",rel:"noopener noreferrer"}},[e._v("支持的请求参数"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("code",[e._v("fetch()")]),e._v(" 接受第二个可选参数，一个可以控制不同配置的 "),r("code",[e._v("init")]),e._v(" 对象：")]),e._v(" "),r("p",[e._v("参考 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/WindowOrWorkerGlobalScope/fetch",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("fetch()")]),r("OutboundLink")],1),e._v("，查看所有可选的配置和更多描述。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Example POST method implementation:\n\npostData('http://example.com/answer', {answer: 42})\n  .then(data => console.log(data)) // JSON from `response.json()` call\n  .catch(error => console.error(error))\n\nfunction postData(url, data) {\n  // Default options are marked with *\n  return fetch(url, {\n    body: JSON.stringify(data), // must match 'Content-Type' header\n    cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached\n    credentials: 'same-origin', // include, same-origin, *omit\n    headers: {\n      'user-agent': 'Mozilla/4.0 MDN Example',\n      'content-type': 'application/json'\n    },\n    method: 'POST', // *GET, POST, PUT, DELETE, etc.\n    mode: 'cors', // no-cors, cors, *same-origin\n    redirect: 'follow', // manual, *follow, error\n    referrer: 'no-referrer', // *client, no-referrer\n  })\n  .then(response => response.json()) // parses response to JSON\n}\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br"),r("span",{staticClass:"line-number"},[e._v("14")]),r("br"),r("span",{staticClass:"line-number"},[e._v("15")]),r("br"),r("span",{staticClass:"line-number"},[e._v("16")]),r("br"),r("span",{staticClass:"line-number"},[e._v("17")]),r("br"),r("span",{staticClass:"line-number"},[e._v("18")]),r("br"),r("span",{staticClass:"line-number"},[e._v("19")]),r("br"),r("span",{staticClass:"line-number"},[e._v("20")]),r("br"),r("span",{staticClass:"line-number"},[e._v("21")]),r("br"),r("span",{staticClass:"line-number"},[e._v("22")]),r("br"),r("span",{staticClass:"line-number"},[e._v("23")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("h3",{attrs:{id:"发送带凭据的请求"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#发送带凭据的请求"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#%E5%8F%91%E9%80%81%E5%B8%A6%E5%87%AD%E6%8D%AE%E7%9A%84%E8%AF%B7%E6%B1%82",target:"_blank",rel:"noopener noreferrer"}},[e._v("发送带凭据的请求"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("为了让浏览器发送包含凭据的请求（即使是跨域源），要将"),r("code",[e._v("credentials: 'include'")]),e._v("添加到传递给 "),r("code",[e._v("fetch()")]),e._v("方法的"),r("code",[e._v("init")]),e._v("对象。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("fetch('https://example.com', {\n  credentials: 'include'\n})\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("p",[e._v("如果你只想在请求URL与调用脚本位于同一起源处时发送凭据，请添加 "),r("code",[e._v("credentials: 'same-origin'")]),e._v("。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// The calling script is on the origin 'https://example.com'\n\nfetch('https://example.com', {\n  credentials: 'same-origin'\n})\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("p",[e._v("要改为确保浏览器不在请求中包含凭据，请使用 "),r("code",[e._v("credentials: 'omit'")]),e._v("。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("fetch('https://example.com', {\n  credentials: 'omit'\n})\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("h3",{attrs:{id:"上传-json-数据"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#上传-json-数据"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#%E4%B8%8A%E4%BC%A0_json_%E6%95%B0%E6%8D%AE",target:"_blank",rel:"noopener noreferrer"}},[e._v("上传 JSON 数据"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("使用 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/WindowOrWorkerGlobalScope/fetch",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("fetch()")]),r("OutboundLink")],1),e._v(" POST JSON数据")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("var url = 'https://example.com/profile';\nvar data = {username: 'example'};\n\nfetch(url, {\n  method: 'POST', // or 'PUT'\n  body: JSON.stringify(data), // data can be `string` or {object}!\n  headers: new Headers({\n    'Content-Type': 'application/json'\n  })\n}).then(res => res.json())\n.catch(error => console.error('Error:', error))\n.then(response => console.log('Success:', response));\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("h3",{attrs:{id:"上传文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#上传文件"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6",target:"_blank",rel:"noopener noreferrer"}},[e._v("上传文件"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("可以通过 HTML "),r("code",[e._v('<input type="file" />')]),e._v(" 元素，"),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/FormData/FormData",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("FormData()")]),r("OutboundLink")],1),e._v(" 和 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/WindowOrWorkerGlobalScope/fetch",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("fetch()")]),r("OutboundLink")],1),e._v(" 上传文件。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("var formData = new FormData();\nvar fileField = document.querySelector(\"input[type='file']\");\n\nformData.append('username', 'abc123');\nformData.append('avatar', fileField.files[0]);\n\nfetch('https://example.com/profile/avatar', {\n  method: 'PUT',\n  body: formData\n})\n.then(response => response.json())\n.catch(error => console.error('Error:', error))\n.then(response => console.log('Success:', response));\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("h3",{attrs:{id:"上传多个文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#上传多个文件"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#%E4%B8%8A%E4%BC%A0%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6",target:"_blank",rel:"noopener noreferrer"}},[e._v("上传多个文件"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("可以通过HTML "),r("code",[e._v('<input type="file" mutiple/>')]),e._v(" 元素，"),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/FormData/FormData",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("FormData()")]),r("OutboundLink")],1),e._v(" 和 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/WindowOrWorkerGlobalScope/fetch",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("fetch()")]),r("OutboundLink")],1),e._v(" 上传文件。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("var formData = new FormData();\nvar photos = document.querySelector(\"input[type='file'][multiple]\");\n\nformData.append('title', 'My Vegas Vacation');\n// formData 只接受文件、Blob 或字符串，不能直接传递数组，所以必须循环嵌入\nfor (let i = 0; i < photos.files.length; i++) {\n    formData.append('photo', photos.files[i]);\n}\n\nfetch('https://example.com/posts', {\n  method: 'POST',\n  body: formData\n})\n.then(response => response.json())\n.then(response => console.log('Success:', JSON.stringify(response)))\n.catch(error => console.error('Error:', error));\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br"),r("span",{staticClass:"line-number"},[e._v("14")]),r("br"),r("span",{staticClass:"line-number"},[e._v("15")]),r("br"),r("span",{staticClass:"line-number"},[e._v("16")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("h3",{attrs:{id:"检测请求是否成功"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#检测请求是否成功"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#%E6%A3%80%E6%B5%8B%E8%AF%B7%E6%B1%82%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F",target:"_blank",rel:"noopener noreferrer"}},[e._v("检测请求是否成功"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("如果遇到网络故障，"),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/WindowOrWorkerGlobalScope/fetch",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("fetch()")]),r("OutboundLink")],1),e._v(" promise 将会 reject，带上一个 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypeError",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("TypeError")]),r("OutboundLink")],1),e._v(" 对象。虽然这个情况经常是遇到了权限问题或类似问题——比如 404 不是一个网络故障。想要精确的判断 "),r("code",[e._v("fetch()")]),e._v(" 是否成功，需要包含 promise resolved 的情况，此时再判断 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Response/ok",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Response.ok")]),r("OutboundLink")],1),e._v(" 是不是为 true。类似以下代码：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("fetch('flowers.jpg').then(function(response) {\n  if(response.ok) {\n    return response.blob();\n  }\n  throw new Error('Network response was not ok.');\n}).then(function(myBlob) {\n  var objectURL = URL.createObjectURL(myBlob);\n  myImage.src = objectURL;\n}).catch(function(error) {\n  console.log('There has been a problem with your fetch operation: ', error.message);\n});\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("h3",{attrs:{id:"自定义请求对象"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#自定义请求对象"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%B7%E6%B1%82%E5%AF%B9%E8%B1%A1",target:"_blank",rel:"noopener noreferrer"}},[e._v("自定义请求对象"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("除了传给 "),r("code",[e._v("fetch()")]),e._v(" 一个资源的地址，你还可以通过使用 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Request/Request",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Request()")]),r("OutboundLink")],1),e._v(" 构造函数来创建一个 request 对象，然后再作为参数传给 "),r("code",[e._v("fetch()")]),e._v("：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("var myHeaders = new Headers();\n\nvar myInit = { method: 'GET',\n               headers: myHeaders,\n               mode: 'cors',\n               cache: 'default' };\n\nvar myRequest = new Request('flowers.jpg', myInit);\n\nfetch(myRequest).then(function(response) {\n  return response.blob();\n}).then(function(myBlob) {\n  var objectURL = URL.createObjectURL(myBlob);\n  myImage.src = objectURL;\n});\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br"),r("span",{staticClass:"line-number"},[e._v("14")]),r("br"),r("span",{staticClass:"line-number"},[e._v("15")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("p",[r("code",[e._v("Request()")]),e._v(" 和 "),r("code",[e._v("fetch()")]),e._v(" 接受同样的参数。你甚至可以传入一个已存在的 request 对象来创造一个拷贝：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("var anotherRequest = new Request(myRequest,myInit);\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("p",[e._v("这个很有用，因为 request 和 response bodies 只能被使用一次（译者注：这里的意思是因为设计成了 stream 的方式，所以它们只能被读取一次）。创建一个拷贝就可以再次使用 request/response 了，当然也可以使用不同的 "),r("code",[e._v("init")]),e._v(" 参数。")]),e._v(" "),r("p",[r("strong",[e._v("注意")]),e._v("："),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Request/clone",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("clone()")]),r("OutboundLink")],1),e._v(" 方法也可以用于创建一个拷贝。它和上述方法一样，如果 request 或 response 的 body 已经被读取过，那么将执行失败。区别在于， "),r("code",[e._v("clone()")]),e._v(" 出的 body 被读取不会导致原 body 被标记为已读取。")]),e._v(" "),r("h2",{attrs:{id:"headers"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#headers"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#headers",target:"_blank",rel:"noopener noreferrer"}},[e._v("Headers"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("使用 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Headers",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Headers")]),r("OutboundLink")],1),e._v(" 的接口，你可以通过 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Headers/Headers",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Headers()")]),r("OutboundLink")],1),e._v(" 构造函数来创建一个你自己的 headers 对象。一个 headers 对象是一个简单的多名值对：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('var content = "Hello World";\nvar myHeaders = new Headers();\nmyHeaders.append("Content-Type", "text/plain");\nmyHeaders.append("Content-Length", content.length.toString());\nmyHeaders.append("X-Custom-Header", "ProcessThisImmediately");\n')])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("p",[e._v("也可以传一个多维数组或者对象字面量：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('myHeaders = new Headers({\n  "Content-Type": "text/plain",\n  "Content-Length": content.length.toString(),\n  "X-Custom-Header": "ProcessThisImmediately",\n});\n')])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("p",[e._v("它的内容可以被获取：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('console.log(myHeaders.has("Content-Type")); // true\nconsole.log(myHeaders.has("Set-Cookie")); // false\nmyHeaders.set("Content-Type", "text/html");\nmyHeaders.append("X-Custom-Header", "AnotherValue");\n\nconsole.log(myHeaders.get("Content-Length")); // 11\nconsole.log(myHeaders.getAll("X-Custom-Header")); // ["ProcessThisImmediately", "AnotherValue"]\n\nmyHeaders.delete("X-Custom-Header");\nconsole.log(myHeaders.getAll("X-Custom-Header")); // [ ]\n')])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("p",[e._v("虽然一些操作只能在 "),r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("ServiceWorkers")]),e._v(" (en-US)"),r("OutboundLink")],1),e._v(" 中使用，但是它提供了更方便的操作 Headers 的 API。")]),e._v(" "),r("p",[e._v("如果使用了一个不合法的HTTP Header属性名，那么Headers的方法通常都抛出 TypeError 异常。如果不小心写入了一个不可写的属性，也会抛出一个 TypeError 异常。除此以外的情况，失败了并不抛出异常。例如：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('var myResponse = Response.error();\ntry {\n  myResponse.headers.set("Origin", "http://mybank.com");\n} catch(e) {\n  console.log("Cannot pretend to be a bank!");\n}\n')])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("p",[e._v("最好在在使用之前检查内容类型 "),r("code",[e._v("content-type")]),e._v(" 是否正确，比如：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('fetch(myRequest).then(function(response) {\n  if(response.headers.get("content-type") === "application/json") {\n    return response.json().then(function(json) {\n      // process your JSON further\n    });\n  } else {\n    console.log("Oops, we haven\'t got JSON!");\n  }\n});\n')])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("h3",{attrs:{id:"guard"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#guard"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#guard",target:"_blank",rel:"noopener noreferrer"}},[e._v("Guard"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("由于 Headers 可以在 request 请求中被发送或者在 response 请求中被接收，并且规定了哪些参数是可写的，Headers 对象有一个特殊的 guard 属性。这个属性没有暴露给 Web，但是它影响到哪些内容可以在 Headers 对象中被操作。")]),e._v(" "),r("p",[e._v("可能的值如下：")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("none")]),e._v("：默认的")]),e._v(" "),r("li",[r("code",[e._v("request")]),e._v("：从 request 中获得的 headers（"),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Request/headers",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Request.headers")]),r("OutboundLink")],1),e._v("）只读")]),e._v(" "),r("li",[r("code",[e._v("request-no-cors")]),e._v("：从不同域（"),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Request/mode",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Request.mode")]),r("OutboundLink")],1),e._v(" "),r("code",[e._v("no-cors")]),e._v("）的 request 中获得的 headers 只读")]),e._v(" "),r("li",[r("code",[e._v("response")]),e._v("：从 response 中获得的 headers（"),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Response/headers",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Response.headers")]),r("OutboundLink")],1),e._v("）只读")]),e._v(" "),r("li",[r("code",[e._v("immutable")]),e._v("：在 ServiceWorkers 中最常用的，所有的 headers 都只读。")])]),e._v(" "),r("p",[r("strong",[e._v("注意")]),e._v("：你不可以添加或者修改一个 guard 属性是 "),r("code",[e._v("request")]),e._v(" 的 Request Header 的 "),r("code",[e._v("Content-Length")]),e._v(" 属性。同样地，插入 "),r("code",[e._v("Set-Cookie")]),e._v(" 属性到一个 response header 是不允许的，因此，Service Worker 中，不能给合成的 Response 的 header 添加一些 cookie。")]),e._v(" "),r("h2",{attrs:{id:"response-对象"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#response-对象"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#response_%E5%AF%B9%E8%B1%A1",target:"_blank",rel:"noopener noreferrer"}},[e._v("Response 对象"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("如上所述，"),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Response",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Response")]),r("OutboundLink")],1),e._v(" 实例是在 "),r("code",[e._v("fetch()")]),e._v(" 处理完 promise 之后返回的。")]),e._v(" "),r("p",[e._v("你会用到的最常见的 response 属性有:")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Response/status",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Response.status")]),r("OutboundLink")],1),e._v(" — 整数（默认值为200）为response的状态码。")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Response/statusText",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Response.statusText")]),r("OutboundLink")],1),e._v(' — 字符串（默认值为"OK"），该值与 HTTP 状态码消息对应。')]),e._v(" "),r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Response/ok",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Response.ok")]),r("OutboundLink")],1),e._v(" — 如上所示，该属性是来检查response的状态是否在 200 - 299（包括200 和 299）这个范围内。该属性返回一个"),r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("布尔值")]),e._v(" (en-US)"),r("OutboundLink")],1),e._v("。")])]),e._v(" "),r("p",[e._v("它的实例也可用通过 JavaScript 来创建，但只有在 "),r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("ServiceWorkers")]),e._v(" (en-US)"),r("OutboundLink")],1),e._v(" 中才真正有用，当使用 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/FetchEvent/respondWith",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("respondWith()")]),r("OutboundLink")],1),e._v(" 方法并提供了一个自定义的 response 来接受 request 时：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('var myBody = new Blob();\n\naddEventListener(\'fetch\', function(event) {\n  event.respondWith(new Response(myBody, {\n    headers: { "Content-Type" : "text/plain" }\n  });\n});\n')])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Response/Response",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Response()")]),r("OutboundLink")],1),e._v(" 构造方法接受两个可选参数—— response 的数据体和一个初始化对象（与"),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Request/Request",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Request()")]),r("OutboundLink")],1),e._v(" 所接受的 init 参数类似。）")]),e._v(" "),r("p",[r("strong",[e._v("注意")]),e._v(": 静态方法 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Response/error",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("error()")]),r("OutboundLink")],1),e._v(" 只是返回了错误的response。与此类似地，"),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Response/redirect",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("redirect()")]),r("OutboundLink")],1),e._v(" 只是返回了一个可以重定向至某 URL 的 response。这些也只与 Service Worker 有关。")]),e._v(" "),r("h2",{attrs:{id:"body"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#body"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#body",target:"_blank",rel:"noopener noreferrer"}},[e._v("Body"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("不管是请求还是响应都能够包含 body 对象。body 也可以是以下任意类型的实例。")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("ArrayBuffer")]),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("ArrayBufferView")]),r("OutboundLink")],1),e._v(" (Uint8Array等)")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Blob",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Blob")]),r("OutboundLink")],1),e._v("/File")]),e._v(" "),r("li",[e._v("string")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/URLSearchParams",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("URLSearchParams")]),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/FormData",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("FormData")]),r("OutboundLink")],1)])]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/orphaned/Web/API/Body",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Body")]),r("OutboundLink")],1),e._v(" 类定义了以下方法（这些方法都被 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Request",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Request")]),r("OutboundLink")],1),e._v(" 和"),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Response",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Response")]),r("OutboundLink")],1),e._v("所实现）以获取 body 内容。这些方法都会返回一个被解析后的"),r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Promise")]),e._v(" (en-US)"),r("OutboundLink")],1),e._v("对象和数据。")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/orphaned/Web/API/Body/arrayBuffer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("arrayBuffer()")]),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/orphaned/Web/API/Body/blob",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("blob()")]),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/orphaned/Web/API/Body/json",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("json()")]),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/orphaned/Web/API/Body/text",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("text()")]),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/orphaned/Web/API/Body/formData",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("formData()")]),r("OutboundLink")],1)])]),e._v(" "),r("p",[e._v("比起XHR来，这些方法让非文本化的数据使用起来更加简单。")]),e._v(" "),r("p",[e._v("请求体可以由传入 body 参数来进行设置：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('var form = new FormData(document.getElementById(\'login-form\'));\nfetch("/login", {\n  method: "POST",\n  body: form\n})\n')])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("p",[e._v("request和response（包括 "),r("code",[e._v("fetch()")]),e._v(" 方法）都会试着自动设置 "),r("code",[e._v("Content-Type")]),e._v("。如果没有设置 "),r("code",[e._v("Content-Type")]),e._v(" 值，发送的请求也会自动设值。")]),e._v(" "),r("h2",{attrs:{id:"特性检测"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#特性检测"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#%E7%89%B9%E6%80%A7%E6%A3%80%E6%B5%8B",target:"_blank",rel:"noopener noreferrer"}},[e._v("特性检测"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("Fetch API 的支持情况，可以通过检测"),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Headers",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Headers")]),r("OutboundLink")],1),e._v(", "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Request",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Request")]),r("OutboundLink")],1),e._v(", "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Response",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Response")]),r("OutboundLink")],1),e._v(" 或 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/WindowOrWorkerGlobalScope/fetch",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("fetch()")]),r("OutboundLink")],1),e._v("是否在"),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Window")]),r("OutboundLink")],1),e._v(" 或 "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Worker",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Worker")]),r("OutboundLink")],1),e._v(" 域中。例如：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("if(self.fetch) {\n    // run my fetch request here\n} else {\n    // do something with XMLHttpRequest?\n}\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br")])]),r("p",[e._v("Copy to Clipboard")]),e._v(" "),r("h2",{attrs:{id:"polyfill"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#polyfill"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#polyfill",target:"_blank",rel:"noopener noreferrer"}},[e._v("Polyfill"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("如果要在不支持的浏览器中使用 Fetch，可以使用 "),r("a",{attrs:{href:"https://github.com/github/fetch",target:"_blank",rel:"noopener noreferrer"}},[e._v("Fetch Polyfill"),r("OutboundLink")],1),e._v("。")]),e._v(" "),r("h2",{attrs:{id:"规范"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#规范"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#%E8%A7%84%E8%8C%83",target:"_blank",rel:"noopener noreferrer"}},[e._v("规范"),r("OutboundLink")],1)]),e._v(" "),r("table",[r("thead",[r("tr",[r("th",{staticStyle:{"text-align":"left"}},[e._v("详细说明")]),e._v(" "),r("th",{staticStyle:{"text-align":"left"}},[e._v("状态")]),e._v(" "),r("th",{staticStyle:{"text-align":"left"}},[e._v("注释")])])]),e._v(" "),r("tbody",[r("tr",[r("td",{staticStyle:{"text-align":"left"}},[r("a",{attrs:{href:"https://fetch.spec.whatwg.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Fetch"),r("OutboundLink")],1)]),e._v(" "),r("td",{staticStyle:{"text-align":"left"}},[e._v("Living Standard")]),e._v(" "),r("td",{staticStyle:{"text-align":"left"}},[e._v("Initial definition")])])])]),e._v(" "),r("h2",{attrs:{id:"浏览器兼容性"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#浏览器兼容性"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7",target:"_blank",rel:"noopener noreferrer"}},[e._v("浏览器兼容性"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("[Report problems with this compatibility data on GitHub](https://github.com/mdn/browser-compat-data/issues/new?body= %23%23%23%23+What+information+was+incorrect%2C+unhelpful%2C+or+incomplete%3F %23%23%23%23+What+did+you+expect+to+see%3F %23%23%23%23+Did+you+test+this%3F+If+so%2C+how%3F   MDN+page+report+details<%2Fsummary> *+Query%3A+"),r("code",[e._v("api.WindowOrWorkerGlobalScope.fetch")]),e._v(" *+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FFetch_API%2FUsing_Fetch *+Report+started%3A+2021-07-19T02%3A40%3A10.801Z <%2Fdetails>&title=api.WindowOrWorkerGlobalScope.fetch+-+)")]),e._v(" "),r("table",[r("thead",[r("tr",[r("th",{staticStyle:{"text-align":"left"}}),e._v(" "),r("th",{staticStyle:{"text-align":"center"}},[e._v("desktop")]),e._v(" "),r("th",{staticStyle:{"text-align":"center"}},[e._v("mobile")]),e._v(" "),r("th",{staticStyle:{"text-align":"center"}}),e._v(" "),r("th",{staticStyle:{"text-align":"center"}}),e._v(" "),r("th",{staticStyle:{"text-align":"center"}}),e._v(" "),r("th",{staticStyle:{"text-align":"center"}}),e._v(" "),r("th",{staticStyle:{"text-align":"center"}}),e._v(" "),r("th",{staticStyle:{"text-align":"center"}}),e._v(" "),r("th",{staticStyle:{"text-align":"center"}}),e._v(" "),r("th",{staticStyle:{"text-align":"center"}}),e._v(" "),r("th",{staticStyle:{"text-align":"center"}}),e._v(" "),r("th")])]),e._v(" "),r("tbody",[r("tr",[r("td",{staticStyle:{"text-align":"left"}}),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Chrome")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Edge")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Firefox")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Internet Explorer")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Opera")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Safari")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("WebView Android")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Chrome Android")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Firefox for Android")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Opera Android")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Safari on iOS")]),e._v(" "),r("td",[e._v("Samsung Internet")])]),e._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"left"}},[r("code",[e._v("fetch")]),e._v("Experimental")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support42")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support14")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support39")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("No supportNo")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support29")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support10.1")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support42")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support42")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support39")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support29")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support10.3")]),e._v(" "),r("td",[e._v("Full support4.0")])]),e._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"left"}},[e._v("Support for blob: and data:Experimental")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support48")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support79")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Compatibility unknown; please update this.?")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("No supportNo")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Compatibility unknown; please update this.?")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Compatibility unknown; please update this.?")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support43")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support48")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Compatibility unknown; please update this.?")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Compatibility unknown; please update this.?")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Compatibility unknown; please update this.?")]),e._v(" "),r("td",[e._v("Full support5.0")])]),e._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"left"}},[e._v("referrerPolicy")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support52")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support79")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support52")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("No supportNo")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support39")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support11.1")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support52")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support52")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support52")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support41")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("No supportNo")]),e._v(" "),r("td",[e._v("Full support6.0")])]),e._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"left"}},[e._v("signalExperimental")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support66")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support16")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support57")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("No supportNo")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support53")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support11.1")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support66")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support66")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support57")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support47")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support11.3")]),e._v(" "),r("td",[e._v("Full support9.0")])]),e._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"left"}},[e._v("Streaming response bodyExperimental")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support43")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support14")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full supportYesdisabledOpen")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("No supportNo")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support29")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support10.1")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support43")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support43")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("No supportNo")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("No supportNo")]),e._v(" "),r("td",{staticStyle:{"text-align":"center"}},[e._v("Full support10.3")]),e._v(" "),r("td",[e._v("Full support4.0")])])])]),e._v(" "),r("h3",{attrs:{id:"legend"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#legend"}},[e._v("#")]),e._v(" Legend")]),e._v(" "),r("h2",{attrs:{id:"参见"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参见"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch#%E5%8F%82%E8%A7%81",target:"_blank",rel:"noopener noreferrer"}},[e._v("参见"),r("OutboundLink")],1)]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API",target:"_blank",rel:"noopener noreferrer"}},[e._v("ServiceWorker API"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS",target:"_blank",rel:"noopener noreferrer"}},[e._v("HTTP access control (CORS)"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP",target:"_blank",rel:"noopener noreferrer"}},[e._v("HTTP"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://github.com/github/fetch",target:"_blank",rel:"noopener noreferrer"}},[e._v("Fetch polyfill"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://github.com/mdn/fetch-examples/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Fetch examples on Github"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=s.exports}}]);